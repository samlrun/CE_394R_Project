# FINDINGS

```{r setup2, include = FALSE}
# load R libraries here; the `include` flag in the chunk options above tells
# whether to print the results or not. Usually you don't want to print the
# library statements, or any code on the pdf.

# Main Packages ========
# I use these in every doc
library(tidyverse)
library(knitr)
library(kableExtra)
library(modelsummary)
library(ggplot2)

options(dplyr.summarise.inform = FALSE)

# Other packages ------
# These sometimes get used, and sometimes don't.
library(mlogit)

# Load functions ------
source("R/functions.R")

# Instructions and options =========
# prints missing data in tables as blank space
options(knitr.kable.NA = '') 
# tells kableExtra to not load latex table packages in the chunk output
options(kableExtra.latex.load_packages = FALSE) 

# round and format numbers that get printed in the text of the article.
inline_hook <- function(x) {
  if (is.numeric(x)) {
    format(x, digits = 3, big.mark = ",")
  } else x
}
knitr::knit_hooks$set(inline = inline_hook)

knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE,
	cache = TRUE
)
# options for latex-only output
if(knitr::is_latex_output()) {
  knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
} 

```

For this study, we are mostly interested in correlation to total injury-causing crashes because these are generally considered severe, and often are or have the potential to be fatal.

<!-- organize so segments and intersections are mentioned independently -->
The correlation between injury crashes and manner of collision are summarized in Figure \@ref(fig:mannerSeverityCorr). We notice that angle crashes tend to be more severe than other crashes, especially at intersections. Interestingly, front to rear crashes are more severe than head on crashes, but this might change if we didn't consider severity 3 crashes since front to rear crashes are incredibly common and often result in minor injury. The only crashes that are very unlikely to be severe are rear to rear and rear to side crashes.

```{r mannerSeverityCorr, fig.align='center', fig.cap="Correlation Between Manner of Collision and Injury (Severity 3-5) Crashes"}
# Manner of Collision severe crash correlations ######################################

seg <- read_csv("data/CAMS_Crashes_14-21.csv")
seg <- corrManner(seg,SEG_ID)
int <- read_csv("data/ISAM_Crashes_14-21.csv")
int <- corrManner(int,INT_ID)

df <- data.frame(
  seg["Severity 3-5 (Injury)"],
  int["Severity 3-5 (Injury)"]) %>%
  rownames_to_column(var = "manner") %>%
  rename(
    Segment = "Severity.3.5..Injury.",
    Intersection = "Severity.3.5..Injury..1") %>%
  pivot_longer(
    cols = c('Segment','Intersection'), 
    names_to = "Type",
    values_to = "corr",)

ggplot(
  data=df, 
  aes(x=manner, y=corr, fill=Type)) +
  geom_bar(
    stat="identity",
    position=position_dodge())+
  geom_text(
    aes(label=corr), 
    vjust=-0.25, 
    #color="white", 
    position = position_dodge(0.9), 
    size=2.5)+
  labs(
    x="Manner of Collision", 
    y = "Pearson Correlation Factor")+
  scale_x_discrete(
    labels = function(manner) str_wrap(manner, width = 10))+
  scale_fill_brewer(palette="Paired")+
  theme_minimal()

```

The correlation between injury crashes and pedestrian variables are shown in Figure \@ref(fig:pedSeverityCorr).

```{r pedSeverityCorr, fig.align='center', fig.cap="Correlation Between Pedestrian Variables and Injury (Severity 3-5) Crashes"}
# Pedestrian severe crash correlations ######################################

seg <- read_csv("data/CAMS_Crashes_Compiled_14-21_fixed.csv")
seg <- corrPedCAMS(seg,SEG_ID)
int <- read_csv("data/ISAM_Crashes_14-21_extra.csv")
int <- corrPed(int,INT_ID)

df <- data.frame(
  seg["Severity 3-5 (Injury)"],
  int["Severity 3-5 (Injury)"]) %>%
  rownames_to_column(var = "ped") %>%
  rename(
    Segment = "Severity.3.5..Injury.",
    Intersection = "Severity.3.5..Injury..1") %>%
  pivot_longer(
    cols = c('Segment','Intersection'), 
    names_to = "Type",
    values_to = "corr",)

ggplot(
  data=df, 
  aes(x=ped, y=corr, fill=Type)) +
  geom_bar(
    stat="identity",
    position=position_dodge())+
  geom_text(
    aes(label=corr), 
    vjust=-0.25, 
    #color="white", 
    position = position_dodge(0.9), 
    size=3.0)+
  labs(
    x="Pedestrian Variables", 
    y = "Pearson Correlation Factor")+
  scale_x_discrete(
    labels = function(manner) str_wrap(manner, width = 10))+
  scale_fill_brewer(palette="Paired")+
  theme_minimal()

```

This analysis could be used to implement more informed safety measures with crash severity in mind. Knowing  which types of crashes are more likely to lead to severe injury will help officials design roadways and inform the public to better avoid these types of collisions. This has applications in automated vehicles as well because engineers can design vehicles to put special emphasis on avoiding the types of crashes that are more likely to lead to severe injury.